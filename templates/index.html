<!DOCTYPE html>
<html>
<head>
    <title>Schelling Model with RL Agents</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container wide">
        <nav class="navigation">
            <a href="/" class="active">Simulation</a>
            <a href="/agent-metrics">Agent Metrics</a>
        </nav>

        <div class="control-panel">
            <h2>Configuration</h2>
            <div class="config-controls">
                <div class="config-actions">
                    <button onclick="loadConfig()">Load Config</button>
                    <button onclick="saveConfig()">Save Config</button>
                    <input type="text" id="configFilename" placeholder="config.json">
                </div>
                <div id="configEditor"></div>
            </div>
        </div>

        <div class="control-panel">
            <h2>Simulation Controls</h2>
            <div class="controls">
                <label>Grid Size: <input type="number" id="gridSize" value="10" min="5" max="50"></label>
                <label>Agents per Type: <input type="number" id="numAgents" value="10" min="5" max="50"></label>
                <label>Episodes: <input type="number" id="numEpisodes" value="200" min="10" max="1000"></label>
                <button onclick="startSimulation()">Start Simulation</button>
            </div>
        </div>
        
        <div class="visualization-wide">
            <div class="grid-container">
                <h3>Schelling Grid</h3>
                <canvas id="gridCanvas"></canvas>
                <div class="legend">
                    <div class="legend-item"><span class="color-box type1"></span>Type 1 Agents</div>
                    <div class="legend-item"><span class="color-box type2"></span>Type 2 Agents</div>
                </div>
            </div>
            <div class="metrics-container">
                <h3>Average Happiness by Type</h3>
                <div id="happinessPlot"></div>
                <h3>Exploration Rate (Epsilon) Decay</h3>
                <div id="epsilonPlot"></div>
                <h3>Learning Rate Schedule</h3>
                <div id="learningRatePlot"></div>
            </div>
            <div class="loss-facets">
                <h3>Agent Loss Facets</h3>
                <div class="facets-container">
                    <div class="facets-type1">
                        <h4>Type 1 Agents</h4>
                        <div id="type1LossFacets"></div>
                    </div>
                    <div class="facets-type2">
                        <h4>Type 2 Agents</h4>
                        <div id="type2LossFacets"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/visualization.js') }}"></script>
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
</body>
</html>